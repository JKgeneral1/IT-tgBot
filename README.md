# IntraDesk Telegram Bot

–ë–æ—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏—Å—Ç–µ–º–æ–π **IntraDesk** –ø—Ä—è–º–æ –≤ Telegram: —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (—Å —Ñ–∞–π–ª–∞–º–∏), –∞–≤—Ç–æ—Å–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–æ–≤, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ **–ª–∏—á–Ω—ã—Ö —á–∞—Ç–æ–≤ –∏ –≥—Ä—É–ø–ø** (–≤–∫–ª—é—á–∞—è —Ç–µ–º—ã/—Ñ–æ—Ä—É–º—ã).

---

## ‚öôÔ∏è –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫ –∏–∑ Telegram (–ª–∏—á–∫–∞ –∏ –≥—Ä—É–ø–ø—ã)
* –ü—Ä–∏–≤—è–∑–∫–∞ —Ç–µ–º—ã/—Ç–æ–ø–∏–∫–∞ –≥—Ä—É–ø–ø—ã –∫ –∑–∞—è–≤–∫–µ: –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ ‚Äî –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∑–∞—è–≤–∫—É
* –ó–∞–≥—Ä—É–∑–∫–∞ –≤–ª–æ–∂–µ–Ω–∏–π (—Ñ–æ—Ç–æ/—Ñ–∞–π–ª—ã) –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
* –ê–≤—Ç–æ–ø–µ—Ä–µ–≤–æ–¥ –≤ —Å—Ç–∞—Ç—É—Å ¬´–û—Ç–∫—Ä—ã—Ç–∞¬ª –ø—Ä–∏ –Ω–æ–≤–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏–∑ —Å—Ç–∞—Ç—É—Å–æ–≤ ¬´–û—Ç–ª–æ–∂–µ–Ω–∞/–¢—Ä–µ–±—É–µ—Ç —É—Ç–æ—á–Ω–µ–Ω–∏—è¬ª
* –í–µ–±—Ö—É–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –∏–∑ IntraDesk (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
* –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üì¶ –°–æ—Å—Ç–∞–≤ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ modules/                 # –ú–æ–¥—É–ª–∏ –±–æ—Ç–∞
‚îÇ  ‚îú‚îÄ config.py
‚îÇ  ‚îú‚îÄ db.py
‚îÇ  ‚îú‚îÄ handlers.py
‚îÇ  ‚îú‚îÄ intradesk_api.py
‚îÇ  ‚îú‚îÄ logger.py
‚îÇ  ‚îú‚îÄ status_cache.py
‚îÇ  ‚îú‚îÄ telegram_bot.py
‚îÇ  ‚îú‚îÄ telegram_utils.py
‚îÇ  ‚îî‚îÄ utils.py
‚îú‚îÄ main.py                  # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ Telegram-–±–æ—Ç–∞ (webhook)
‚îú‚îÄ idk_webhook.py           # –í–µ–±—Ö—É–∫-–ø—Ä–∏—ë–º–Ω–∏–∫ –æ—Ç IntraDesk (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ config_example.ini       # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥–∞ (—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤ config.ini)
‚îú‚îÄ config.ini               # –†–∞–±–æ—á–∏–π –∫–æ–Ω—Ñ–∏–≥ (—Å–æ–∑–¥–∞—ë—Ç–µ —Å–∞–º–∏)
‚îú‚îÄ Dockerfile
‚îú‚îÄ docker-compose.yml
‚îî‚îÄ requirements.txt
```

---

## üñ•Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É

* VPS —Å Ubuntu 22.04+ (–∏–ª–∏ Debian 11+)
* –î–æ–º–µ–Ω —Å –≤–∞–ª–∏–¥–Ω—ã–º SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º (–¥–ª—è Telegram –≤–µ–±—Ö—É–∫–∞)
* Docker –∏ Docker Compose
* –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø–∞–º—è—Ç—å: 2 –ì–ë RAM

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker (–µ—Å–ª–∏ –µ—â—ë –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω):

```bash
curl -fsSL https://get.docker.com | sh
sudo apt install -y docker-compose
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ Git)

1. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∞—Ä—Ö–∏–≤** –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä (zip/tar.gz) –∏ —Ä–∞—Å–ø–∞–∫—É–π—Ç–µ:

```bash
mkdir -p /opt/it-bot && cd /opt/it-bot
# –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∞—Ä—Ö–∏–≤ –≤ —ç—Ç—É –ø–∞–ø–∫—É –ª—é–±—ã–º —É–¥–æ–±–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º
unzip it-bot.zip
```

2. **–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥** `config.ini` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞:

```bash
cp config_example.ini config.ini
nano config.ini
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è:

* `Telegram.token` ‚Äî —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ @BotFather
* `Webhook.public_base` ‚Äî –≤–∞—à –¥–æ–º–µ–Ω —Å HTTPS (–Ω–∞–ø—Ä–∏–º–µ—Ä, [https://bot.example.com](https://bot.example.com))
* `Webhook.path` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø—É—Ç—å –≤–µ–±—Ö—É–∫–∞, –Ω–∞–ø—Ä. `tg/supersecret123`
* `IntraDesk.api_key`, `IntraDesk.auth_token` ‚Äî –∫–ª—é—á–∏ –∏–∑ IntraDesk

3. **–°–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ** –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:

```bash
docker-compose build
docker-compose up -d
```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** (–ø–æ –∂–µ–ª–∞–Ω–∏—é):

```bash
docker-compose logs -f bot
```

5. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤–µ–±—Ö—É–∫ Telegram** (–∑–∞–º–µ–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏ –∞–¥—Ä–µ—Å):

```bash
curl -F "url=https://<–≤–∞—à-–¥–æ–º–µ–Ω>/<–ø—É—Ç—å-–∏–∑-–∫–æ–Ω—Ñ–∏–≥–∞>" \
     https://api.telegram.org/bot<TELEGRAM_BOT_TOKEN>/setWebhook
```

–ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
curl https://api.telegram.org/bot<TELEGRAM_BOT_TOKEN>/getWebhookInfo
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ @BotFather (–¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ –≥—Ä—É–ø–ø–∞—Ö)

–ß—Ç–æ–±—ã –±–æ—Ç –≤–∏–¥–µ–ª —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø–∞—Ö:

1. –í @BotFather ‚Üí `/mybots` ‚Üí –≤—ã–±—Ä–∞—Ç—å –±–æ—Ç–∞
2. **Bot Settings** ‚Üí **Group Privacy** ‚Üí **Turn off** (–≤—ã–∫–ª—é—á–∏—Ç—å Privacy Mode)
3. –í –≥—Ä—É–ø–ø–µ –¥–∞—Ç—å –±–æ—Ç—É –ø—Ä–∞–≤–∞ —á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è. –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–µ–º—ã/—Ñ–æ—Ä—É–º—ã ‚Äî —Ç–∞–∫–∂–µ –ø—Ä–∞–≤–æ **Manage Topics**.

---

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ/–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose restart

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ c –∑–∞–º–µ–Ω–æ–π —Ñ–∞–π–ª–æ–≤ –∞—Ä—Ö–∏–≤–∞
docker-compose down
# –∑–∞–º–µ–Ω–∏—Ç–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –Ω–æ–≤—ã–µ
docker-compose build
docker-compose up -d
```

---

## üóÑÔ∏è –û –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (SQLite)

–í –ø–∞–ø–∫–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ—è–≤–ª—è—é—Ç—Å—è —Ñ–∞–π–ª—ã:

* `tickets.db` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ë–î
* `tickets.db-shm` ‚Äî —Å–ª—É–∂–µ–±–Ω–∞—è shared-memory (—Ä–µ–∂–∏–º WAL)
* `tickets.db-wal` ‚Äî –∂—É—Ä–Ω–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π

–£–¥–∞–ª—è—Ç—å **–Ω–µ–ª—å–∑—è**, –µ—Å–ª–∏ –±–∞–∑–∞ –Ω—É–∂–Ω–∞. –î–ª—è ¬´—á–∏—Å—Ç–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞¬ª –¥–æ–ø—É—Å—Ç–∏–º–æ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ç—Ä–∏ —Ñ–∞–π–ª–∞ ‚Äî –±–æ—Ç —Å–æ–∑–¥–∞—Å—Ç –ø—É—Å—Ç—É—é –±–∞–∑—É –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ.

## üß∞ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã? ‚Üí `docker ps`
* –õ–æ–≥–∏ –±–æ—Ç–∞ ‚Üí `docker-compose logs -f bot`
* –í–µ–±—Ö—É–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω? ‚Üí `getWebhookInfo`
* SSL –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω? –î–æ–º–µ–Ω —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `Webhook.public_base`?

